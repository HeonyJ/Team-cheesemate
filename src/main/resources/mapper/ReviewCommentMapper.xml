<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="team.cheese.Dao.MyPage.ReviewCommentDao">
    <sql id="selectReviewComment">
        select
            no,
            sal_id,
            psn,
            buy_id,
            buy_nick,
            contents,
            like_cnt,
            r_date,
            m_date,
            ur_state,
            ad_state,
            first_date,
            first_id,
            last_date,
            last_id
        from review_comment
    </sql>
    <select id="count" parameterType="String" resultType="int">
        select count(*)
        from review_comment
        where sal_id = #{sal_id}
    </select>
    <select id="select"  parameterType="Integer" resultType="ReviewCommentDto">
        <include refid="selectReviewComment"/>
        where no = #{no}
    </select>
    <select id="selectAll" parameterType="String" resultType="ReviewCommentDto">
        <include refid="selectReviewComment"/>
        where sal_id = #{sal_id}
        order by r_date desc, no desc
    </select>
    <insert id="insert" parameterType="ReviewCommentDto">
        insert into review_comment (sal_id, buy_id, buy_nick, contents)
        select #{sal_id},id,nick,#{contents}
        from user
        where id = #{buy_id}
    </insert>
    <update id="update" parameterType="ReviewCommentDto">
        update review_comment
        set contents = #{contents}
          , m_date = now()
        where buy_id = #{buy_id} and no = #{no}
    </update>
    <delete id="delete" parameterType="map">
        delete from review_comment
        where buy_id = #{buy_id} and no = #{no}
    </delete>
    <delete id="deleteAll" parameterType="String">
        delete from review_comment where sal_id = #{sal_id}
    </delete>
    <update id="incrementLikeCnt" parameterType="Integer">
        update review_comment
        set like_cnt = like_cnt+1
        where no = #{no}
    </update>
    <update id="UserStateChange" parameterType="map">
        update review_comment
        <if test="ur_state=='Y'">
            set ur_state = 'N'
        </if>
        <if test="ur_state=='N'">
            set ur_state = 'Y'
        </if>
        where no = #{no}
    </update>
    <update id="AdminStateChange" parameterType="map">
        update review_comment
        <if test="ad_state=='N'">
            set ad_state = 'Y'
        </if>
        <if test="ad_state=='Y'">
            set ad_state = 'N'
        </if>
        where no = #{no}
    </update>
</mapper>