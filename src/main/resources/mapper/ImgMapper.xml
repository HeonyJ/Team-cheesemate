<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="team.cheese.dao.ImgDao">

    <insert id="insert_img" parameterType="ImgDto">
        insert into img (tb_name, tb_no, imgtype, file_rt, u_name, o_name, e_name, w_size, h_size)
        values (#{tb_name}, #{tb_no}, #{imgtype}, #{filert}, #{u_name}, #{o_name}, #{e_name}, #{w_size}, #{h_size});
    </insert>

    <select id="select_img" resultType="ImgDto">
        select * from img;
    </select>

    <select id="select_simg_view" parameterType="map" resultType="ImgDto">
        SELECT *
        FROM img
        WHERE state = 'Y'
        and tb_name = #{tb_name}
        and no IN (SELECT img_no FROM ${cross_tb} WHERE sal_no = #{sal_no});
    </select>

    <update id="state_change_img" parameterType="map">
        update img set state = #{state} where no = #{no};
    </update>

<!--    <insert id="insert_cross" parameterType="map">-->
<!--        INSERT INTO sale_img (sal_no, img_no)-->
<!--        SELECT s.no AS sale_no, i.no AS img_no-->
<!--        FROM ${cross_tb} s, img i-->
<!--        where s.no = #{no} and i.tb_name = #{cross_tb} and i.tb_no = #{no};-->
<!--    </insert>-->

    <!-- 이미지 교차 테이블 작성 -->
    <insert id="insert_cross" parameterType="map">
        INSERT INTO ${tb_name} (${col_name}, img_no)
        SELECT s.${no_name} AS ${col_name}, i.no AS img_no
        FROM ${cross_tb_name} s, img i
        where s.${no_name} = #{no} and i.tb_name = #{cross_tb_name} and i.tb_no = #{no};
    </insert>

    <select id="select_sale_img" resultType="ImgDto">
        select * from img;
    </select>

    <delete id="delete_cross_all" parameterType="string">
        delete from ${tb_name};
    </delete>

    <delete id="delete_img_all" parameterType="int">
        delete from img;
    </delete>

    <select id="select_s_imglist" resultType="ImgDto">
        select s.no as s_no, i.imgtype, s.title as s_title, s.price as s_price, s.r_date as s_r_date, i.file_rt, i.u_name, i.o_name, i.e_name
        from img i, sale s, sale_img si
        where si.sal_no = s.no and si.img_no = i.no and i.imgtype = 's' and i.state = 'Y' order by s.r_date desc limit 10;
    </select>

    <select id="select_w_imglist" parameterType="int" resultType="ImgDto">
        select i.file_rt, i.u_name, i.o_name, i.e_name
        from img i, sale s, sale_img si
        where si.sal_no = s.no and si.img_no = i.no and i.imgtype = 'w' and i.state = 'Y' and s.no = #{no};
    </select>

</mapper>